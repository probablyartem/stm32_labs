#ifndef TRAFFIC_LIGHT_H
#define TRAFFIC_LIGHT_H

#include "stm32f4xx_hal.h"
#include <stdint.h>

/* --------------------------------------------
 * Состояния светофора
 * --------------------------------------------*/
typedef enum {
    STATE_RED = 0,
    STATE_GREEN,
    STATE_GREEN_BLINK,
    STATE_YELLOW
} TrafficState_t;

/* --------------------------------------------
 * Инициализация светофора (GPIO, кнопки, нач. состояние)
 * --------------------------------------------*/
void TrafficLight_Init(void);

/* --------------------------------------------
 * Вызывать в основном цикле.
 * Псевдопараллельное переключение: красный ->
 * зеленый -> мигание зеленым -> желтый -> красный.
 * Если mode=1 — учитываем кнопку, mode=2 — игнорируем.
 * --------------------------------------------*/
void TrafficLight_Update(void);

/* --------------------------------------------
 * Установить режим "mode 1" или "mode 2"
 * --------------------------------------------*/
void TrafficLight_SetMode(uint8_t mode);

/* Получить текущий режим */
uint8_t TrafficLight_GetMode(void);

/* --------------------------------------------
 * Установить таймаут (секунды), в течение которых
 * горит красный.
 * --------------------------------------------*/
void TrafficLight_SetRedTimeoutSec(uint32_t sec);

/* Узнать, сколько сейчас (сек) */
uint32_t TrafficLight_GetRedTimeoutSec(void);

/* --------------------------------------------
 * Получить текущее состояние светофора (STATE_...)
 * --------------------------------------------*/
TrafficState_t TrafficLight_GetState(void);

/* --------------------------------------------
 * Вернуть строку с названием состояния:
 * "red", "green", "blinking green", "yellow"
 * --------------------------------------------*/
const char* TrafficLight_GetStateString(void);

/* --------------------------------------------
 * Обновление кнопки (дребезг).
 * Желательно вызывать часто в main.
 * --------------------------------------------*/
void Button_Update(void);

#endif // TRAFFIC_LIGHT_H

