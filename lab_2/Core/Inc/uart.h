#ifndef INC_UART_H_
#define INC_UART_H_

#include "stm32f4xx_hal.h"
#include <stdint.h>

/* ------------------------------------------------------------------
   Инициализация UART (скорость 57600)
   ------------------------------------------------------------------*/
void APP_UART_Init(void);

/* ------------------------------------------------------------------
   Переключение режима прерываний (on/off).
   Если on: запускается HAL_UART_Receive_IT(...)
   Если off: используем Polling.
   ------------------------------------------------------------------*/
void APP_UART_SetInterruptMode(uint8_t onOff);

/* ------------------------------------------------------------------
   Возвращает 1, если мы сейчас в interrupt-режиме, иначе 0 (polling).
   ------------------------------------------------------------------*/
uint8_t APP_UART_IsInterruptMode(void);

/* ------------------------------------------------------------------
   Обработка входящих данных в режиме polling:
   - вызывается в главном цикле
   - пытается считать 1 байт (timeout=0) и отдать парсеру
   ------------------------------------------------------------------*/
void APP_UART_ProcessPolling(void);

/* ------------------------------------------------------------------
   Функция обратного вызова из прерывания (IRQ).
   Нужно вызывать в USARTx_IRQHandler.
   ------------------------------------------------------------------*/
void APP_UART_IRQ_Handler(void);

/* ------------------------------------------------------------------
   Callback HAL при завершении приёма байта (RxCplt).
   ------------------------------------------------------------------*/
void APP_UART_RxCpltCallback(UART_HandleTypeDef *huart);

/* ------------------------------------------------------------------
   Вызывается в основном цикле, если interrupt-режим:
   выгребаем байты из кольцевого буфера, парсим, делаем эхо
   ------------------------------------------------------------------*/
void APP_UART_ProcessInterrupt(void);

/* ------------------------------------------------------------------
   Вспомогательные ф-ции для вывода строк
   ------------------------------------------------------------------*/
void APP_UART_SendString(const char *s);
void APP_UART_SendOK(void);
void APP_UART_SendUnknown(void);

#endif /* INC_UART_H_ */
